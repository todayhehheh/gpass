<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²€ì •ê³ ì‹œ íŒ¨ìŠ¤ (Pass)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: "Pretendard Variable", Pretendard, sans-serif; }
        .hidden { display: none; }
        
        /* ğŸ“œ ì§€ë¬¸ ë°•ìŠ¤ ë””ìì¸ (ê°€ë…ì„± UP) */
        .passage-box {
            background-color: #fdfbf7; /* ì¢…ì´ ì§ˆê° ìƒ‰ìƒ */
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            border-left: 5px solid #64748b; /* ì™¼ìª½ ê°•ì¡° ì„  */
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            font-family: 'Noto Serif KR', serif; /* ëª…ì¡°ì²´ */
            font-size: 1.05rem;
            line-height: 1.8;
            color: #2d3748;
            white-space: pre-line;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* ğŸ·ï¸ ì§€ë¬¸ ë²ˆí˜¸ ë¼ë²¨ (ì˜ˆ: [7~8]) */
        .passage-label {
            display: inline-block;
            background-color: #64748b;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 0.3rem;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 0.8rem;
            font-family: "Pretendard Variable", sans-serif;
        }

        /* ğŸ–ï¸ ë°‘ì¤„ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        u {
            text-decoration: none;
            border-bottom: 2px solid #ef4444; /* ë¹¨ê°„ ë°‘ì¤„ */
            padding-bottom: 1px;
            font-weight: bold;
            color: #b91c1c;
        }

        /* ğŸ”² ë¹ˆì¹¸ ê°•ì¡° ìŠ¤íƒ€ì¼ (ë°ì´í„°ì—ì„œ (   ) ë¶€ë¶„ì„ ì´ í´ë˜ìŠ¤ë¡œ ê°ìŒ€ ì˜ˆì •) */
        .blank-box {
            display: inline-block;
            border: 1px solid #94a3b8;
            background-color: white;
            color: #ef4444;
            padding: 0 0.5rem;
            margin: 0 0.2rem;
            border-radius: 0.2rem;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }

        .question-text {
            font-size: 1.15rem;
            font-weight: 700;
            color: #1e293b;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-center sticky top-0 z-50">
        <h1 class="text-xl font-bold text-blue-600 cursor-pointer flex items-center gap-2" onclick="goHome()">
            ğŸ“ ê²€ì •ê³ ì‹œ íŒ¨ìŠ¤
        </h1>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8">

        <div id="page-main" class="fade-in">
            <h2 class="text-2xl font-bold text-center mb-2">ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ê³µë¶€í• ê¹Œìš”?</h2>
            <p class="text-center text-slate-500 mb-10">ìì‹ ì—ê²Œ ë§ëŠ” í•™ìŠµ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>

            <div class="grid md:grid-cols-3 gap-6">
                <div onclick="selectMode('study')" class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 hover:border-blue-500 hover:shadow-md cursor-pointer transition text-center group">
                    <div class="text-5xl mb-4 group-hover:scale-110 transition">ğŸ“–</div>
                    <h3 class="text-xl font-bold mb-2">í‹ˆí‹ˆì´ ê³µë¶€</h3>
                    <p class="text-slate-500 text-sm">í•œ ë¬¸ì œì”© í’€ê³ <br>ë°”ë¡œ í•´ì„¤ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
                </div>
                <div onclick="selectMode('exam')" class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 hover:border-blue-500 hover:shadow-md cursor-pointer transition text-center group">
                    <div class="text-5xl mb-4 group-hover:scale-110 transition">ğŸ’¯</div>
                    <h3 class="text-xl font-bold mb-2">ê¸°ì¶œ ê·¸ëŒ€ë¡œ</h3>
                    <p class="text-slate-500 text-sm">ì‹¤ì œ ì‹œí—˜ì§€ì²˜ëŸ¼<br>ì²˜ìŒë¶€í„° ëê¹Œì§€ í’‰ë‹ˆë‹¤.</p>
                </div>
                <div onclick="selectMode('mock')" class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 hover:border-blue-500 hover:shadow-md cursor-pointer transition text-center group">
                    <div class="text-5xl mb-4 group-hover:scale-110 transition">ğŸ²</div>
                    <h3 class="text-xl font-bold mb-2">ì‹¤ì „ ëª¨ì˜ê³ ì‚¬</h3>
                    <p class="text-slate-500 text-sm">ë¬¸ì œë¥¼ ëœë¤ìœ¼ë¡œ ì„ì–´ì„œ<br>ì‹¤ë ¥ì„ ì ê²€í•©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>

        <div id="page-filter" class="hidden fade-in">
            <div class="bg-white p-8 rounded-2xl shadow-sm max-w-lg mx-auto">
                <h3 class="text-xl font-bold mb-6 text-center" id="filter-title">ì¡°ê±´ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-1">ê³¼ì •</label>
                        <select id="sel-level" class="w-full border p-3 rounded-lg">
                            <option value="ê³ ì¡¸">ê³ ì¡¸</option>
                            <option value="ì¤‘ì¡¸">ì¤‘ì¡¸</option>
                            <option value="ì´ˆì¡¸">ì´ˆì¡¸</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-1">ì—°ë„</label>
                        <select id="sel-year" class="w-full border p-3 rounded-lg">
                            <option value="2025">2025ë…„</option>
                            <option value="2024">2024ë…„</option>
                            <option value="2023">2023ë…„</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-1">íšŒì°¨</label>
                        <select id="sel-round" class="w-full border p-3 rounded-lg">
                            <option value="1">1íšŒ</option>
                            <option value="2">2íšŒ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-1">ê³¼ëª©</label>
                        <select id="sel-subject" class="w-full border p-3 rounded-lg">
                            <option value="êµ­ì–´">êµ­ì–´</option>
                            <option value="ìˆ˜í•™">ìˆ˜í•™</option>
                            <option value="ì˜ì–´">ì˜ì–´</option>
                            <option value="ì‚¬íšŒ">ì‚¬íšŒ</option>
                            <option value="ê³¼í•™">ê³¼í•™</option>
                            <option value="í•œêµ­ì‚¬">í•œêµ­ì‚¬</option>
                            <option value="ë„ë•">ë„ë•</option>
                        </select>
                    </div>
                </div>
                <div class="mt-8 flex gap-3">
                    <button onclick="goHome()" class="flex-1 bg-slate-100 text-slate-600 py-3 rounded-xl font-bold hover:bg-slate-200 transition">ë’¤ë¡œê°€ê¸°</button>
                    <button onclick="startQuiz()" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition">ë¬¸ì œ í’€ê¸° ì‹œì‘</button>
                </div>
            </div>
        </div>

        <div id="page-quiz" class="hidden fade-in">
            <div id="score-board" class="hidden bg-blue-600 text-white rounded-xl p-6 text-center mb-6 shadow-lg">
                <p class="text-blue-100 text-sm mb-1">ë‚˜ì˜ ì‹œí—˜ ê²°ê³¼</p>
                <div class="text-4xl font-extrabold mb-2"><span id="final-score">0</span>ì </div>
                <div id="result-message" class="bg-white/20 rounded-lg p-3 mb-3 text-sm font-medium"></div>
                <p class="text-sm opacity-80" id="score-detail"></p>
                <button onclick="goHome()" class="mt-4 bg-white text-blue-600 text-xs px-4 py-2 rounded-lg font-bold hover:bg-blue-50">ë‹¤ë¥¸ ê³¼ëª© í’€ê¸°</button>
            </div>

            <div class="flex justify-between items-center mb-6">
                <span class="font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-lg text-sm" id="quiz-info-text"></span>
                <button onclick="goHome()" class="text-sm text-slate-400 hover:text-slate-600">ì¢…ë£Œí•˜ê¸°</button>
            </div>

            <div id="quiz-container" class="space-y-8"></div>
        </div>

    </main>

    <script src="data.js"></script>

    <script>
        let currentMode = "";
        let currentProblems = [];
        let studyIndex = 0;

        function showPage(pageId) {
            ['page-main', 'page-filter', 'page-quiz'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function goHome() {
            showPage('page-main');
            document.getElementById('score-board').classList.add('hidden');
        }

        function selectMode(mode) {
            currentMode = mode;
            showPage('page-filter');
            const titleMap = {
                'study': 'í‹ˆí‹ˆì´ ê³µë¶€ ëª¨ë“œ ì„¤ì •',
                'exam': 'ê¸°ì¶œ ê·¸ëŒ€ë¡œ í’€ê¸° ì„¤ì •',
                'mock': 'ì‹¤ì „ ëª¨ì˜ê³ ì‚¬ ì„¤ì •'
            };
            document.getElementById('filter-title').innerText = titleMap[mode];
        }

        function startQuiz() {
            const year = document.getElementById('sel-year').value;
            const round = document.getElementById('sel-round').value;
            const subject = document.getElementById('sel-subject').value;

            if (typeof problemDB === 'undefined') {
                alert("ë¬¸ì œ ë°ì´í„°(data.js)ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // ë¬¸ì œ í•„í„°ë§
            currentProblems = problemDB.filter(p => p.year === year && p.round === round && p.subject === subject);

            if (currentMode === 'mock') {
                currentProblems.sort(() => Math.random() - 0.5);
            }

            // ë°ì´í„° ì—†ìŒ ì•ˆë‚´
            if (currentProblems.length === 0) {
                showPage('page-quiz');
                document.getElementById('quiz-info-text').innerText = "ğŸš§ ë°ì´í„° ì¤€ë¹„ ì¤‘";
                document.getElementById('quiz-container').innerHTML = `
                    <div class="text-center py-20">
                        <div class="text-6xl mb-4">ğŸ™</div>
                        <h3 class="text-xl font-bold mb-2">ì•„ì§ ë¬¸ì œê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ì–´ìš”.</h3>
                        <p class="text-slate-500 mb-6">ë°ì´í„° ì—…ë°ì´íŠ¸ë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</p>
                        <button onclick="goHome()" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold">ëŒì•„ê°€ê¸°</button>
                    </div>`;
                document.getElementById('score-board').classList.add('hidden');
                return;
            }

            showPage('page-quiz');
            document.getElementById('quiz-info-text').innerText = `${year}ë…„ ${round}ì°¨ ${subject}`;
            
            const container = document.getElementById('quiz-container');
            container.innerHTML = "";
            document.getElementById('score-board').classList.add('hidden');

            if (currentMode === 'study') {
                studyIndex = 0;
                renderStudyProblem(container);
            } else {
                renderExamList(container);
            }
        }

        // [ëª¨ë“œ 1] ê³µë¶€ ëª¨ë“œ (í•œ ë¬¸ì œì”©)
        function renderStudyProblem(container) {
            if (studyIndex >= currentProblems.length) {
                container.innerHTML = `<div class="text-center py-20"><h3 class="text-2xl font-bold mb-4">í•™ìŠµ ì™„ë£Œ! ğŸ‰</h3><button onclick="goHome()" class="bg-blue-600 text-white px-6 py-2 rounded-xl">ì²˜ìŒìœ¼ë¡œ</button></div>`;
                return;
            }
            const p = currentProblems[studyIndex];
            
            let html = `
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded">ë¬¸ì œ ${studyIndex + 1} / ${currentProblems.length}</span>
                    </div>

                    ${p.passage ? `<div class="passage-box">${p.passage}</div>` : ''}

                    <h3 class="question-text">${p.question}</h3>

                    ${p.image ? `<div class="flex justify-center mb-6"><img src="${p.image}" onerror="this.style.display='none'" class="w-full max-w-md h-auto rounded-lg border border-slate-100 shadow-sm"></div>` : ''}

                    <div class="space-y-3 mb-6">
                        ${p.options.map((opt, idx) => `
                            <button onclick="checkStudyAnswer(${idx}, ${p.answer}, this)" class="w-full text-left p-4 rounded-xl border border-slate-200 hover:bg-slate-50 transition font-medium text-slate-700 flex items-start">
                                <span class="mr-3 font-bold text-slate-400 bg-slate-100 w-6 h-6 flex items-center justify-center rounded-full text-xs">${idx+1}</span>
                                <span>${opt}</span>
                            </button>
                        `).join('')}
                    </div>

                    <div id="explanation-${studyIndex}" class="hidden bg-blue-50 p-5 rounded-xl border border-blue-100">
                        <p class="font-bold text-lg mb-2" id="result-msg-${studyIndex}"></p>
                        <div class="text-slate-700 text-sm leading-relaxed">${p.explanation}</div>
                        <button onclick="nextStudy()" class="mt-4 bg-blue-600 text-white px-6 py-3 rounded-xl font-bold text-sm hover:bg-blue-700 w-full md:w-auto shadow-lg shadow-blue-500/30">ë‹¤ìŒ ë¬¸ì œ â†’</button>
                    </div>
                </div>`;
            container.innerHTML = html;
        }

        function checkStudyAnswer(selected, correct, btn) {
            const expBox = document.getElementById(`explanation-${studyIndex}`);
            if(!expBox.classList.contains('hidden')) return;
            
            expBox.classList.remove('hidden');
            const msg = document.getElementById(`result-msg-${studyIndex}`);
            
            if (selected === correct) {
                btn.classList.add('bg-green-100', 'border-green-500', 'text-green-900');
                msg.innerHTML = "<span class='text-green-600'>ì •ë‹µì…ë‹ˆë‹¤! â­•</span>";
            } else {
                btn.classList.add('bg-red-50', 'border-red-500', 'text-red-900');
                msg.innerHTML = "<span class='text-red-600'>í‹€ë ¸ìŠµë‹ˆë‹¤. âŒ</span>";
                const buttons = btn.parentElement.querySelectorAll('button');
                buttons[correct].classList.add('bg-green-50', 'border-green-500', 'text-green-700');
            }
        }

        function nextStudy() {
            studyIndex++;
            renderStudyProblem(document.getElementById('quiz-container'));
        }

        // [ëª¨ë“œ 2] ì‹œí—˜ ëª¨ë“œ (ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ + ì§€ë¬¸ ê·¸ë£¹í™”)
        function renderExamList(container) {
            let html = `<div class="bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-slate-200 divide-y divide-slate-100">`;
            
            for (let i = 0; i < currentProblems.length; i++) {
                const p = currentProblems[i];
                
                // --- [ì§€ë¬¸ ê·¸ë£¹í™” ë¡œì§ ì‹œì‘] ---
                let showPassage = false;
                let groupEndIndex = i;

                // 1. ì§€ë¬¸ì´ ìˆê³  + (ì²« ë¬¸ì œì´ê±°ë‚˜ OR ì• ë¬¸ì œì™€ ì§€ë¬¸ì´ ë‹¤ë¥¼ ë•Œ) -> ì§€ë¬¸ í‘œì‹œ
                if (p.passage && (i === 0 || p.passage !== currentProblems[i-1].passage)) {
                    showPassage = true;
                    
                    // 2. ì´ ì§€ë¬¸ì„ ê³µìœ í•˜ëŠ” ë§ˆì§€ë§‰ ë¬¸ì œê°€ ëª‡ ë²ˆì¸ì§€ ì°¾ê¸° (Look-ahead)
                    for (let j = i + 1; j < currentProblems.length; j++) {
                        if (currentProblems[j].passage === p.passage) {
                            groupEndIndex = j;
                        } else {
                            break;
                        }
                    }
                }
                // --- [ì§€ë¬¸ ê·¸ë£¹í™” ë¡œì§ ë] ---

                html += `<div class="py-10 first:pt-0" id="prob-box-${i}">`;

                // ì§€ë¬¸ ë°•ìŠ¤ ì¶œë ¥ (ê·¸ë£¹ì˜ ì‹œì‘ì¼ ë•Œë§Œ 1ë²ˆ ì¶œë ¥)
                if (showPassage) {
                    let rangeLabel = "";
                    // ê·¸ë£¹ì´ë©´ [7~9] í‘œì‹œ, ë‹¨ë…ì´ë©´ í‘œì‹œ ì•ˆ í•¨(ë˜ëŠ” [7])
                    if (groupEndIndex > i) {
                        rangeLabel = `<span class="passage-label">ë¬¸ì œ [${i + 1} ~ ${groupEndIndex + 1}]</span>`;
                    }
                    html += `
                        <div class="passage-area">
                            ${rangeLabel}
                            <div class="passage-box">${p.passage}</div>
                        </div>`;
                }

                html += `
                    <div class="text-slate-400 font-bold text-sm mb-2">ë¬¸ì œ ${i + 1}</div>
                    <h3 class="question-text">${p.question}</h3>
                    ${p.image ? `<div class="mb-4 flex justify-center"><img src="${p.image}" onerror="this.style.display='none'" class="w-full max-w-md h-auto rounded-lg border border-slate-100"></div>` : ''}
                    
                    <div class="space-y-2">
                        ${p.options.map((opt, oIdx) => `
                            <label class="flex items-center space-x-3 p-3 rounded-lg hover:bg-slate-50 cursor-pointer border border-transparent hover:border-slate-200 transition">
                                <input type="radio" name="prob_${i}" value="${oIdx}" class="w-5 h-5 text-blue-600 border-slate-300 focus:ring-blue-500">
                                <span class="text-slate-700 font-medium">${opt}</span>
                            </label>
                        `).join('')}
                    </div>

                    <div id="exam-feedback-${i}" class="hidden mt-6 p-5 bg-slate-50 rounded-xl text-sm border border-slate-200">
                        <p class="font-bold text-slate-800 mb-2 text-base">ì •ë‹µ: <span class="text-blue-600">${p.options[p.answer]}</span></p>
                        <div class="text-slate-600 leading-relaxed">${p.explanation}</div>
                    </div>
                </div>`;
            }
            
            html += `<div class="pt-8 text-center">
                <button onclick="gradeExam()" class="bg-blue-600 text-white px-12 py-4 rounded-xl font-bold text-xl hover:bg-blue-700 shadow-lg shadow-blue-500/30 transition w-full md:w-auto">ì±„ì í•˜ê¸°</button>
            </div></div>`;
            container.innerHTML = html;
        }

        function gradeExam() {
            if(!confirm("ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            let correctCount = 0;
            currentProblems.forEach((p, idx) => {
                const radios = document.getElementsByName(`prob_${idx}`);
                let selected = -1;
                let box = document.getElementById(`prob-box-${idx}`);
                for(let r of radios) { if(r.checked) selected = parseInt(r.value); }
                
                document.getElementById(`exam-feedback-${idx}`).classList.remove('hidden');
                
                if(selected === p.answer) {
                    correctCount++;
                    box.classList.add('bg-green-50/30');
                    box.querySelector('.text-slate-400').innerHTML += " <span class='text-green-600 ml-2'>â­•</span>";
                } else {
                    box.classList.add('bg-red-50/30');
                    box.querySelector('.text-slate-400').innerHTML += " <span class='text-red-600 ml-2'>âŒ</span>";
                }
            });

            const score = Math.round((correctCount / currentProblems.length) * 100);
            
            // ì ìˆ˜ë³„ ë©˜íŠ¸ (ê²©ë ¤ ë©”ì‹œì§€)
            let msg = "";
            if (score === 100) msg = "ğŸ’¯ ì™„ë²½í•´ìš”! ì´ ê³¼ëª©ì€ ë§ˆìŠ¤í„°í•˜ì…¨ë„¤ìš”!";
            else if (score >= 60) msg = "ğŸ‰ í•©ê²©ê¶Œì…ë‹ˆë‹¤! í‹€ë¦° ë¬¸ì œë§Œ í™•ì¸í•˜ë©´ ì™„ë²½í•´ìš”.";
            else msg = "ğŸŒ± ì‹œì‘ì´ ë°˜ì´ì—ìš”. í•´ì„¤ì„ ë³´ë©° ì°¨ê·¼ì°¨ê·¼ ë‹¤ì‹œ í•´ë´ìš”!";

            document.getElementById('score-board').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('result-message').innerText = msg;
            document.getElementById('score-detail').innerText = `ì´ ${currentProblems.length}ë¬¸ì œ ì¤‘ ${correctCount}ë¬¸ì œ ì •ë‹µ`;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
